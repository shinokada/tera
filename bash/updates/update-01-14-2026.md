# TERA Update - January 13, 2026

## File Rename - Better User Experience

### sample.json → myfavorite.json
**Files:** `tera`, `lib/lib.sh`, `lib/search.sh`, `docs/README.md`

**Change:**
- Renamed default favorite list from `sample.json` to `myfavorite.json`
- "sample" was confusing and sounded temporary
- "myfavorite" is clear, personal, and intuitive

**Migration:**
- Automatic migration on first run for existing users
- If `sample.json` exists, it's renamed to `myfavorite.json`
- All stations preserved, zero data loss
- New users get `myfavorite.json` from the start

**Files Updated:**
- `tera` - Changed `FAVORITE_FILE` constant and added migration logic
- `lib/lib.sh` - Updated `_play_favorite_station()` to use new filename
- `lib/search.sh` - Updated display name mapping
- `docs/README.md` - Updated documentation

**User Experience:**
- More intuitive filename: `~/.config/tera/favorite/myfavorite.json`
- Still displays as "Favorite" in the UI
- Seamless upgrade with automatic migration

---

## Critical Bug Fix

### Quick Play Favorites Not Showing Saved Stations
**Files:** `tera` (main file) and `lib/lib.sh`

**Issue:**
- Quick Play Favorites was reading from `${script_dir}/lib/favorite.json` (static repo file)
- Users saving to "Favorite" were saving to `~/.config/tera/favorite/sample.json` (user config)
- Result: Newly saved stations never appeared in Quick Play Favorites

**Fix:**
- Changed both functions to read from `${FAVORITE_PATH}/sample.json`
- Now reads from the same file where users save stations
- Saved stations now appear immediately in Quick Play Favorites

**User Experience:**
- Save a station to "Favorite" → It appears in Quick Play Favorites on main menu
- Complete workflow integration from search → save → quick play

---

## Changes Made

### 1. Delete a Radio Station Page - Main Menu Option
**File:** `lib/delete_station.sh`

**Changes:**
- Added check to return to main menu if user cancels list selection
- Updated the prompt to clarify that users can enter "0" to return to Main Menu
- Changed prompt from "Type your station number to delete." to "Type your station number to delete (or 0 for Main Menu):"
- Added early return if LIST is empty or "0"

**User Experience:**
- Users can now easily return to the Main Menu by selecting "0" at any point
- More intuitive navigation

### 2. I Feel Lucky Page - Main Menu Option  
**File:** `lib/lucky.sh`

**Changes:**
- Updated prompt from "Genre/keyword (or type 'menu' to return to Main Menu):" to "Genre/keyword (or press Enter to return to Main Menu):"
- Empty input now returns to Main Menu via the existing check

**User Experience:**
- Simpler interaction - just press Enter to go back
- More consistent with other pages

### 3. Save Station Page - Complete Overhaul
**File:** `lib/search.sh` - Function `_save_station_to_list()`

**Changes:**
- Complete redesign of the save station interface
- Added clear screen and proper heading: "TERA - Save Station"
- Implemented fzf-based selection with arrow key navigation
- Added "0) Main Menu" option at the top of the list
- Display "Favorite" instead of "sample" for better UX (sample.json is the default favorites file)
- Proper conversion between display name ("Favorite") and file name ("sample")
- Added "Main Menu" option that returns to the main menu when selected
- Added 2-second sleep after successful save for better feedback

**User Experience:**
- Much more intuitive interface with arrow key navigation
- Users can see "Favorite" as the default list name instead of technical "sample"
- Easy escape to Main Menu
- Visual feedback after saving

### 4. Search Pages - Main Menu Navigation
**File:** `lib/search.sh` - Function `search_by()`

**Changes:**
- Updated all search prompts to include "(or press Enter to return to Main Menu)"
- Example: "Type a tag to search (or press Enter to return to Main Menu):"
- Added empty input check that returns to Main Menu
- Works for all search types: tag, name, language, country code, and state

**User Experience:**
- Consistent navigation across all search pages
- Press Enter at any search prompt to return to Main Menu
- No need to type special commands or use Ctrl+C

## Technical Implementation Notes

### Arrow Key Navigation
All menus that were updated now use `fzf` for selection:
- Users can navigate with arrow keys (up/down/left/right)
- Enter to select
- ESC to cancel (returns to appropriate menu)

### Display Name Handling
The system uses "sample.json" internally but displays "Favorite" to users for better UX:
```bash
if [ "$list" = "sample" ]; then
    DISPLAY_NAME="Favorite"
else
    DISPLAY_NAME="$list"
fi
```

### Consistent Behavior
All pages now follow the same pattern:
1. Clear heading with page title
2. Instructions with escape option
3. Arrow key navigation where applicable
4. "0" or "Enter" to return to Main Menu

## Testing Recommendations

Test the following user flows:

1. **Delete Station:**
   - Try canceling at list selection
   - Try entering "0" when selecting station number
   
2. **I Feel Lucky:**
   - Press Enter without typing anything
   - Verify it returns to Main Menu

3. **Save Station After Search:**
   - Search for a station and try to save it
   - Use arrow keys to navigate the list selection
   - Select "0) Main Menu" option
   - Select "1) Favorite" and verify station saves correctly
   
4. **Search By Tag/Name/Language/etc:**
   - Press Enter without typing anything on any search prompt
   - Verify all return to Main Menu correctly

## Files Modified

1. `lib/delete_station.sh` - Added Main Menu navigation
2. `lib/lucky.sh` - Simplified Main Menu return
3. `lib/search.sh` - Complete redesign of save function and improved search navigation
4. `tera` - Fixed Quick Play Favorites to read from user's config
5. `lib/lib.sh` - Fixed _play_favorite_station to use user's config

## Backward Compatibility

All changes are backward compatible:
- Existing favorite lists continue to work
- The internal file structure remains unchanged
- sample.json still functions as before, just displays as "Favorite"
